---
title: "Attenberg2013 Figure 4 Reproduction"
author: "Harel Lustiger"
output: 
#  pdf_document: 
#    highlight: tango
html_document: 
highlight: tango
theme: journal
bibliography: references.bib   
nocite: | 
        @Attenberg2013
---

```{r global_options, include=FALSE, echo=FALSE}
Sys.setlocale("LC_TIME", "English")

packages_list = c("knitr","pander")
sapply(packages_list, 
       function(package){
           if(!require(package, character.only=TRUE)) 
               install.packages(package,dep=TRUE)
           require(package, character.only=TRUE)})

opts_chunk$set(fig.width=8, fig.height=4, fig.path='figs/', dev='png', dpi=300, 
               echo=FALSE, warning=FALSE, message=FALSE, results='hide')
```

```{r pandoc_options, include=FALSE, echo=FALSE}
panderOptions('table.split.table', Inf)
panderOptions('digits', 3)
panderOptions('round', 3)
panderOptions('keep.trailing.zeros', TRUE)
# performance.table <- table(some_table)
# pandoc.table(performance.table, style = "rmarkdown", justify = 'left', 
# caption = 'Performance table') 
```

`r format(Sys.time(), "%d-%b-%Y")`

# Adult dataset

```{r Attenberg2013_Figure4_Adult}
#################
# Load the data #
#################
#' One file which contains 4 runs (with multiple repetition) named 
#' "Figure 4.csv" is expected
# Local Run
# reports = read.csv(file.path(getwd(),'docs','data','Figure 4 Adult.csv'))
# Run time
reports  = read.csv(file.path('data','Figure 4 Adult.csv'))


#######################
# Change ratios names #
#######################
reports$Imb.R = paste0('Adult [Imb.R.:',reports$Imb.R,']')
reports$Imb.R = factor(reports$Imb.R, levels=c("Adult [Imb.R.:3]",
                                               "Adult [Imb.R.:10]",
                                               "Adult [Imb.R.:20]",
                                               "Adult [Imb.R.:30]"))


###############
# Aggregation #
###############
colnames(reports)
reports_agg = aggregate(
    cbind(Nl_majority, Nl_minority, 
          AUC, PRBEP) ~ Imb.R + QueryMethod + Iteration + Nl,
    reports, function(x) mean(x, trim=0.1, na.rm=T))


#################
# Visualisation #
#################
library(ggplot2)
library(plotly)
colnames(reports_agg)
fig4_adult = ggplot(reports_agg, aes(x=Nl, y=PRBEP, group=QueryMethod)) + 
    # Add lines to the plot
    geom_line(aes(colour = QueryMethod), size=1) + 
    # Wrap a 1d ribbon of panels into 2d
    facet_wrap(~ Imb.R, ncol=2, nrow=2) + 
    ## Set x axis attributes
    xlab('# Training instances') +
    #scale_x_continuous(breaks = seq(0,max(reports_agg$N),100)) +
    ## Set y axis attributes
    scale_y_continuous(breaks = seq(0,1,0.1)) +
    # Set theme
    theme_bw()

plot(fig4_adult)
ggplotly(fig4_adult)
```


# Letter dataset

```{r Attenberg2013_Figure4_Letter}
#################
# Load the data #
#################
#' One file which contains 4 runs (with multiple repetition) named 
#' "Figure 4.csv" is expected
# Local Run
# reports = read.csv(file.path(getwd(),'docs','data','Figure 4 Letter.csv'))
# Run time
reports  = read.csv(file.path('data','Figure 4 Letter.csv'))


#######################
# Change ratios names #
#######################
reports$Imb.R = paste0('Letter [Imb.R.:',reports$Imb.R,']')
reports$Imb.R = factor(reports$Imb.R, levels=c("Letter [Imb.R.:3]",
                                               "Letter [Imb.R.:10]",
                                               "Letter [Imb.R.:20]",
                                               "Letter [Imb.R.:30]"))


###############
# Aggregation #
###############
colnames(reports)
reports_agg = aggregate(
    cbind(Nl_majority, Nl_minority, 
          AUC, PRBEP) ~ Imb.R + QueryMethod + Iteration + Nl,
    reports, function(x) mean(x, trim=0.1, na.rm=T))


#################
# Visualisation #
#################
library(ggplot2)
library(plotly)
colnames(reports_agg)
fig4_letter = ggplot(reports_agg, aes(x=Nl, y=PRBEP, group=QueryMethod)) + 
    # Add lines to the plot
    geom_line(aes(colour = QueryMethod), size=1) + 
    # Wrap a 1d ribbon of panels into 2d
    facet_wrap(~ Imb.R, ncol=2, nrow=2) + 
    ## Set x axis attributes
    xlab('# Training instances') +
    #scale_x_continuous(breaks = seq(0,max(reports_agg$N),100)) +
    ## Set y axis attributes
    scale_y_continuous(breaks = seq(0,1,0.1)) +
    # Set theme
    theme_bw()

plot(fig4_letter)
ggplotly(fig4_letter)
```


# References