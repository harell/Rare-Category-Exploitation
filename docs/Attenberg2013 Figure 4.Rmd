---
title: "Attenberg2013 Figure 4 Reproduction"
author: "Harel Lustiger"
output: 
#  pdf_document: 
#    highlight: tango
html_document: 
highlight: tango
theme: journal
bibliography: references.bib   
nocite: | 
        @Attenberg2013
---

```{r global_options, include=FALSE, echo=FALSE}
Sys.setlocale("LC_TIME", "English")

packages_list = c("knitr","pander")
sapply(packages_list, 
       function(package){
           if(!require(package, character.only=TRUE)) 
               install.packages(package,dep=TRUE)
           require(package, character.only=TRUE)})

opts_chunk$set(fig.width=8, fig.height=4, fig.path='figs/', dev='png', dpi=300, 
               echo=FALSE, warning=FALSE, message=FALSE, results='hide')
```

```{r pandoc_options, include=FALSE, echo=FALSE}
panderOptions('table.split.table', Inf)
panderOptions('digits', 3)
panderOptions('round', 3)
panderOptions('keep.trailing.zeros', TRUE)
# performance.table <- table(some_table)
# pandoc.table(performance.table, style = "rmarkdown", justify = 'left', 
# caption = 'Performance table') 
```

`r format(Sys.time(), "%d-%b-%Y")`

```{r Attenberg2013_Figure4}
#################
# Load the data #
#################
file_names = c('(ADULT)(Imb.R.=0.5)',
               '(ADULT)(Imb.R.=0.1111)',
               '(ADULT)(Imb.R.=0.0526)',
               '(ADULT)(Imb.R.=0.0345)')
ratios_names = c('3','10','20','30')
ratios_names = paste0('Adult [Imb.R.:',ratios_names,']')

reports = data.frame()
for (r in 1:length(file_names))
{
    # Local
    #report = read.csv(file.path(getwd(),'docs','data',paste0(file_names[r],'.csv')))
    # Run time
    report  = read.csv(file.path('data',paste0(file_names[r],'.csv')))
    
    report$Imb.R = ratios_names[r]
    reports = rbind(reports,report)
}

###############
# Aggregation #
###############
colnames(reports)
reports_agg = aggregate(
    cbind(N_majority,N_minority,AUC,PRBEP,LIFT) ~ Imb.R + QueryMethod + Iteration + N,
    reports, function(x) mean(x,trim=0.1))
reports_agg$Imb.R = factor(reports_agg$Imb.R, levels=ratios_names)


#################
# Visualisation #
#################
library(ggplot2)
library(plotly)
colnames(reports_agg)
fig4 = ggplot(reports_agg, aes(x=N, y=PRBEP, group=QueryMethod)) + 
    # Add lines to the plot
    geom_line(aes(colour = QueryMethod), size=1) + 
    # Wrap a 1d ribbon of panels into 2d
    facet_wrap(~ Imb.R, ncol=2, nrow=2) + 
    ## Set x axis attributes
    xlab('#Training instances') +
    #scale_x_continuous(breaks = seq(0,max(reports_agg$N),100)) +
    ## Set y axis attributes
    scale_y_continuous(breaks = seq(0,1,0.1)) +
    # Set theme
    theme_bw()

plot(fig4)
ggplotly(fig4)
```





# References