---
title: "Attenberg2013 Table 1 Reproduction"
author: "Harel Lustiger"
output: 
#  pdf_document: 
#    highlight: tango
html_document: 
highlight: tango
theme: journal
bibliography: references.bib   
nocite: | 
        @Attenberg2013
---

```{r global_options, include=FALSE, echo=FALSE}
Sys.setlocale("LC_TIME", "English")

packages_list = c("knitr","pander")
sapply(packages_list, 
       function(package){
           if(!require(package, character.only=TRUE)) 
               install.packages(package,dep=TRUE)
           require(package, character.only=TRUE)})

opts_chunk$set(fig.width=8, fig.height=4, fig.path='figs/', dev='png', dpi=300, 
               echo=FALSE, warning=FALSE, message=FALSE, results='hide')
```

```{r pandoc_options, include=FALSE, echo=FALSE}
panderOptions('table.split.table', Inf)
panderOptions('digits', 3)
panderOptions('round', 3)
panderOptions('keep.trailing.zeros', TRUE)
# performance.table <- table(some_table)
# pandoc.table(performance.table, style = "rmarkdown", justify = 'left', 
# caption = 'Performance table') 
```

`r format(Sys.time(), "%d-%b-%Y")`


```{r Attenberg2013_Table_1, results='asis'}
#################
# Load the data #
#################
reports = data.frame()
dataset_names = c("Letter",       # 1
                  "Satimage",     # 2
                  "Abalone",      # 3
                  "Adult")[1:3]   # 4
for(name in dataset_names)
{
    # Absolute path
    # report = read.csv(file.path(getwd(),'docs','data',
    #                             paste0('Table 1 ',name,'.csv')))
    # Relative path
    report = read.csv(file.path('data',
                                paste0('Table 1 ',name,'.csv')))
    # Bind reports    
    reports = rbind(reports,cbind(DB=name,report))
} # end for load the data
# colnames(reports)


######################
# Allocate the table #
######################
table1 = data.frame(
    Dataset         = NA,
    AUC.RS          = NA,
    AUC.AL          = NA,
    Imb.Ratio       = NA,
    SV.Ratio        = NA,
    Data.Efficiency = NA)


###############
# Aggregation #
###############
reports_agg = aggregate(
    cbind(Nl_majority, Nl_minority,
          AUC, PRBEP, LIFT, 
          SV_majority, SV_minority,
          Data.Efficiency) ~ 
        DB + Imb.R + QueryMethod + Iteration + Nl,
    reports, mean)#function(x) mean(x,trim=0.1))
#colnames(reports_agg)


###################
# Fill up table 1 #
###################
dataset_names = unique(reports_agg$DB)
for(name in dataset_names)
{
    ind = (1:length(dataset_names))[dataset_names %in% name]
    report_agg = subset(reports_agg, DB == name)
    max_iteration_random = max(subset(report_agg, QueryMethod=="random", select=Iteration))
    max_iteration_svm    = max(subset(report_agg, QueryMethod=="svm", select=Iteration))

    ## Dataset
    table1[ind,"Dataset"] = name
    ## AUC.RS
    value  = subset(report_agg, 
                    Iteration==max_iteration_random & QueryMethod=="random", 
                    select=AUC)
    table1[ind,"AUC.RS"] = paste0(round(value*100,2),'%')
    ## AUC.AL
    value  = subset(report_agg, 
                    Iteration==max_iteration_random & QueryMethod=="svm", 
                    select=AUC)
    table1[ind,"AUC.AL"] = paste0(round(value*100,2),'%')
    ## Imb.Ratio
    table1[ind,"Imb.Ratio"] = paste0(report_agg[1,"Imb.R"],'%')
    ## SV.Ratio
    values = subset(report_agg, 
                    Iteration==max_iteration_random & QueryMethod=="svm", 
                    select=c(SV_majority,SV_minority))
    value  = with(values, SV_majority/SV_minority)
    table1[ind,"SV.Ratio"] = round(value,2)
    ## Data.Efficiency
    value = max(subset(report_agg,QueryMethod=="svm",select=Data.Efficiency))
    table1[ind,"Data.Efficiency"] = paste0(round(value,2),'%')
} #end filling up table1

pandoc.table(table1, style = "rmarkdown", justify = 'left', 
caption = 'Table 1 [@Attenberg2013]') 
```


# References