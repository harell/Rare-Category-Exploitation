#' AUCTM
#'
#' 
#' 
AUCTM <- function(x,    # number of instances within the labeled set
                  y,    # number of minorities cases within the unlabeled set
                  x_max=max(x), # optional: the right boundary
                  y_max=max(y), # maximum number of possible minority cases
                  plot=F) # Plot the shape being evaluated 
{
    #################
    # Visualisation #
    #################
    # Plot curve
    if(plot){
        plot(x, y, type="o", col="green4", xaxt="n",
             xlab="# of labeled instances",
             ylab="# minorities within the labeled set")
        axis(1, at=seq(0, max(x), 200), las=2)
    }
    # Plot boundaries
    ## Bottom boundary
    if(plot)
        abline(h=y[1], lty=2)
    ## Left boundary
    y_offset = -x[1] + y[1] # -100 + 8 = -92
    if(plot)
        lines(x, x+y_offset, lty=2)
    ## Right boundary
    x_max = min(x_max, max(x), na.rm=T)
    if(plot)
        abline(v=x_max, lty=2)
    ## Upper boundary
    y_out = approx(x, x+y_offset, xout=x_max, method="linear")[["y"]] 
    y_max = min(y_max, y_out, max(y), na.rm=T)
    if(plot)
        abline(h=y_max, lty=2)
    ## Points
    bl = c(min(x),min(y)) # bottom left
    br = c(x_max,min(y))  # bottom right
    xout = approx(x+y_offset, x, xout=y_max, method="linear")[["y"]]   
    tl = c(xout, y_max)  # top left
    tr = c(x_max,y_max)  # top right
    
    if(plot){
        points(x=bl[1], y=bl[2], cex=1, pch=16, col="red")
        points(x=br[1], y=br[2], cex=1, pch=16, col="red")
        points(x=tl[1], y=tl[2], cex=1, pch=16, col="red")
        points(x=tr[1], y=tr[2], cex=1, pch=16, col="red")
    }
    
    ####################
    # Area Calculation #
    ####################
    #          a
    #     ___________
    #    /           \
    #   /          h \ S_max = (a+b)*h/2
    #  /      b      \
    #  ---------------
    #
    # a = ymax + xmin
    # b = xmax - xmin
    # h = ymax - ymin
    # S_max = (a+b)*h/2
    #
    a = tr[1] - tl[1]
    b = br[1] - bl[1]
    h = tl[2] - bl[2]
    S_max = (a+b)*h/2
    S_max
    
    S = 0
    for(i in 2:sum(x<=x_max))
    {
        ## Points
        bl = c(x[i-1], min(y)) # bottom left
        br = c(x[i],   min(y)) # bottom right
        tl = c(x[i-1], y[i-1]) # top left
        tr = c(x[i],   y[i])   # top right 
        ## Area Calculation
        a = tl[2] - bl[2]
        b = tr[2] - br[2]
        h = br[1] - bl[1]
        S = S + (a+b)*h/2
    }# end for
    
    S
    return(S/S_max)
}# AUCTM