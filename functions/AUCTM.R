#' AUCTM
#'
#' 
#' 
AUCTM <- function(x,    # number of instances within the labeled set
                  y,    # number of minorities cases within the unlabeled set
                  x_max=max(x), # optional: the right boundary
                  y_max=max(y), # maximum number of possible minority cases
                  plot=F) # Plot the shape being evaluated 
{
    x_max = min(x_max, max(x), na.rm=T)
    ###########################
    # Find trapezoid vertices #
    ###########################
    ## Original vertices
    org_x  = x[x<=x_max]
    org_y  = y[x<=x_max]
    org_bl = c(min(x), min(y))
    org_br = c(x_max,  min(y))
    org_tl = c(min(x), y_max)
    org_tr = c(x_max,  y_max)
    ## Offset vertices
    off_x  = x[x<=x_max] - x[1]
    off_y  = y[x<=x_max] - y[1]
    off_bl = c(min(x) - x[1], min(y) - range(y)[1])
    off_br = c(x_max  - x[1], min(y) - range(y)[1])
    off_tl = c(min(x) - x[1], y_max - range(y)[1])
    off_tr = c(x_max  - x[1], y_max - range(y)[1])

    
    #################
    # Visualisation #
    #################
    if(plot){
        # Plot curve
        plot(x, y, type="o", col="green4", xaxt="n",
             xlab="# of labeled instances",
             ylab="# minorities within the labeled set",
             ylim=c(0,y_max))
        axis(1, at=seq(0, max(x), 200), las=2)
        abline(h=0); abline(v=0)
        
        
        # Plot boundaries
        ## Bottom boundary
        abline(h=org_y[1], lty=2)
        ## Left boundary
        abline(v=org_x[1], lty=2)
        ## Right boundary
        abline(v=x_max, lty=2)
        ## Upper boundary
        abline(h=y_max, lty=2)
        
        
        # Plot points
        points(x=org_bl[1], y=org_bl[2], cex=1, pch=16, col="red")
        points(x=org_br[1], y=org_br[2], cex=1, pch=16, col="red")
        points(x=org_tl[1], y=org_tl[2], cex=1, pch=16, col="red")
        points(x=org_tr[1], y=org_tr[2], cex=1, pch=16, col="red")
        
        
        # Plot random sampling benchmark
        Imb.R = max(x)/max(y)
        abline(a=0, b=Imb.R^(-1), lty=4, col="purple") 
    }# end plot
    
    
    ####################
    # Area Calculation #
    ####################
    #          a
    #     ___________
    #    /           \
    #   /          h \ S_max = (a+b)*h/2
    #  /      b      \
    #  ---------------
    #
    # a = ymax + xmin
    # b = xmax - xmin
    # h = ymax - ymin
    # S_max = (a+b)*h/2
    #
    a = off_tr[1] - off_tl[1]
    b = off_br[1] - off_bl[1]
    h = off_tl[2] - off_bl[2]
    S_max = (a+b)*h/2

    S = 0
    for(i in 2:length(off_x))
    {
        ## Points
        bl = c(off_x[i-1], min(off_y)) # bottom left
        br = c(off_x[i],   min(off_y)) # bottom right
        tl = c(off_x[i-1], off_y[i-1]) # top left
        tr = c(off_x[i],   off_y[i])   # top right 
        ## Area Calculation
        a = tl[2] - bl[2]
        b = tr[2] - br[2]
        h = br[1] - bl[1]
        S = S + (a+b)*h/2
    }# end for
    
    if(plot)
    {
        text(x=org_bl[1], y=2*a/3, paste("AUCTM=",round(S/S_max,3)), pos=3, col="green4")
        text(x=x_max, y=y_max, paste0("(",x_max,",",y_max,")"), pos=1, col="green4")
    }
    return(S/S_max)
}# AUCTM