---
title: "Attenberg2013 Figure 5 Reproduction"
author: "Harel Lustiger"
output: 
#  pdf_document: 
#    highlight: tango
html_document: 
highlight: tango
theme: journal
bibliography: references.bib   
nocite: | 
        @Attenberg2013
---

```{r global_options, include=FALSE, echo=FALSE}
Sys.setlocale("LC_TIME", "English")

packages_list = c("knitr","pander")
sapply(packages_list, 
       function(package){
           if(!require(package, character.only=TRUE)) 
               install.packages(package,dep=TRUE)
           require(package, character.only=TRUE)})

opts_chunk$set(fig.width=8, fig.height=4, fig.path='figs/', dev='png', dpi=300, 
               echo=FALSE, warning=FALSE, message=FALSE, results='hide')
```

```{r pandoc_options, include=FALSE, echo=FALSE}
panderOptions('table.split.table', Inf)
panderOptions('digits', 3)
panderOptions('round', 3)
panderOptions('keep.trailing.zeros', TRUE)
# performance.table <- table(some_table)
# pandoc.table(performance.table, style = "rmarkdown", justify = 'left', 
# caption = 'Performance table') 
```

`r format(Sys.time(), "%d-%b-%Y")`

Figure 5 investigates how the number of support vectors changes when presented
with examples selected according to AL and RS. 

Because the base rate of the dataset gathered by RS approaches that of the 
example pool, the support vector imbalance ratio quickly approaches the data 
imbalance ratio. 

As learning continues, the learner should gradually see all the instances within 
the final margin and the support vector imbalance ratio decreases.

At the end of training with RS, the support vector imbalance ratio is the data 
imbalance ratio within the margin.

The support vector imbalance ratio curve of AL is drastically different than RS. 
AL intelligently picks the instances closest to the margin in each step.

Since the data imbalance ratio within the margin is lower than data imbalance 
ratio, the support vectors in AL are more balanced than RS during learning.


```{r Attenberg2013_Figure5_Satimage}
#################
# Load the data #
#################
# Local Run
# reports = read.csv(file.path(getwd(),'docs','data',
#                              paste0('Figure 5',' ','Satimage','.csv')))
# Run time
reports  = read.csv(file.path('data',
                              paste0('Figure 5',' ','Satimage','.csv')))

colnames(reports)


##################
# Pro-processing #
##################
# SV.R
reports = transform(reports, SV.R=SV_majority/SV_minority)
# SV.R.Inv
reports = transform(reports, SV.R.Inv=SV_minority/SV_majority)
# Summary Statistics of Data Subsets
reports_agg = aggregate(
    cbind(SV.R, SV.R.Inv) ~ QueryMethod + Iteration + Nl,
    reports, function(x) mean(x, trim=0.1, na.rm=T))


#################
# Visualisation #
#################
library(ggplot2)
library(plotly)
colnames(reports_agg)
fig5_Satimage = ggplot(reports_agg, aes(x=Nl, y=SV.R.Inv, group=QueryMethod)) + 
    # Add lines to the plot
    geom_line(aes(colour = QueryMethod), size=1) + 
    # Wrap a 1d ribbon of panels into 2d
    #facet_wrap(~ Imb.R, ncol=2, nrow=2) + 
    ## Set x axis attributes
    xlab('# Training instances') +
    #scale_x_continuous(breaks = seq(0,max(reports_agg$N),100)) +
    ## Set y axis attributes
    scale_y_continuous(breaks = seq(0,1,0.1), limits=c(0,1)) +
    ylab("SV+/SV-") + 
    # Set theme
    annotate("text", x=1e3, y=0, label=paste0("data ratio:",round((reports[1,"Imb.R"])^-1,4))) + 
    ggtitle(expression(
        atop("Support Vector ratios in AL and RS", atop("Satimage dataset", "")))) + 
    theme_bw()

plot(fig5_Satimage)
# ggplotly(fig5_Satimage)
```



# References