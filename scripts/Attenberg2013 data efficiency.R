#'  Attenberg2013 - Data efficiency
#' 
#'  
##################
# Initialization #
##################
rm(list = ls()); cat("\014")
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))


################
# Load dataset #
################
dataset_name = c("Letter",       # 1
                 "Satimage",     # 2
                 "Abalone",      # 3
                 "Adult")[4]     # 4
dataset = load_dataset(dataset_name)
p = ncol(dataset)-1
n = nrow(dataset)


##############################
# Control simulation nuances #
##############################
iterations  = 10
repetitions = 1
verbose = TRUE


##############
# Simulation #
##############

##########################
# Repetition Allocations #
########################## 
if(verbose) cat('\n',rep('#',40),
                '\n','# Starting new simulation',
                '\n',rep('#',40),
                sep='')
report = data.frame()


#####################
# Split the dataset #
#####################
index_list = split_dataset(X=dataset[,1:p], y=dataset[,p+1],
                           train_pct=100/n, seed_train=2015,
                           test_pct=1/3, seed_test=2017)

for(i in 0:iterations){ 
    if(verbose) cat('\n','# Iteration ', i, '/', iterations, sep='')
    #######################################
    # Assign data-points into their group #
    #######################################
    DS_train     = dataset[index_list[["index_train"]],]
    DS_test      = dataset[index_list[["index_test"]],]
    DS_unlabeled = dataset[index_list[["index_unlabeled"]],]
    DS_labeled   = dataset[index_list[["index_labeled"]],]
    
    
    ##########################################
    #  Fit model on the labeled data-points  #
    #                   &                    #
    # Evaluate the model on the training set #
    ##########################################
    if(verbose) cat('\n','# Fitting and Evaluating model', sep='')
    set.seed(20160322)
    criteria_list = fit_and_evaluate_model(train_set=DS_labeled,
                                           test_set=DS_test,
                                           inducer="SVM")
    
    
    #####################
    # Store the results #
    #####################
    new_entery = data.frame(Iteration=i,
                            N=nrow(DS_labeled),
                            AUC=criteria_list$AUC)
    report = rbind(report,new_entery)
    if(verbose) cat('\n','# AUC=', round(criteria_list$AUC,3), sep='')
    
    
    #####################################
    # Query the next data-points to add #
    #####################################
    if(iterations==i){
        if(verbose) cat('\n','# Done', sep='')
        next
        }
    if(verbose) cat('\n','# Querying the next batch', sep='')
    
    num_query = 50
    ## Choose instances from the unlabeled pool 
    set.seed(20160322)
    index_chosen = sample(index_list[["index_unlabeled"]],num_query)
    ## Update index_list
    index_list[["index_labeled"]]   = union(index_list[["index_labeled"]],index_chosen)
    index_list[["index_unlabeled"]] = setdiff(index_list[["index_unlabeled"]],index_chosen)

    
    if(verbose) cat('\n', '#', sep='')
} # end iterations



report


plot(report$N,report$AUC, type='o')






































