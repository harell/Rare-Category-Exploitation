################################################################################
# He2013imbalanced - Evaluation Metrics (ch. 3)
################################################################################
# options(error=recover) # debugging mode


##################
# Initialization #
##################
rm(list = ls()); cat("\014")
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))


################
# Load dataset #
################
dataset_name = c("Letter",       # 1
                 "Satimage",     # 2
                 "Abalone",      # 3
                 "Adult")[2]     # 4
dataset = load_dataset(dataset_name)
p = ncol(dataset)-1
n = nrow(dataset)


#####################
# Split the dataset #
#####################
index_list = split_dataset(X=dataset[,1:p], y=dataset[,p+1],
                           train_pct=2/3, seed_train=2015,
                           test_pct=1/3, seed_test=2017)


#######################################
# Assign data-points into their group #
#######################################
DS_train = dataset[index_list[["index_train"]],]
DS_test  = dataset[index_list[["index_test"]],]


#################################
# Fit model to the training-set #
#################################
set.seed(20160323)
mdl.binomial = glm(label~., family = "binomial", data=DS_train)


##################################
# Evaluate model on the test-set #
##################################
# Pr(y=minority) \in [0,1]
predictions = predict(mdl.binomial, DS_test, type="response") 
pred        = ROCR::prediction(predictions, DS_test[,"label"])
# 3.4.1 Balanced Accuracy While
# 3.4.2 ROC Curves
# 3.4.3 Precision and Recall
PR_obj = ROCR::performance(pred, "prec", "rec")
plot(PR_obj)
e_Recall    = unlist(PR_obj@x.values)
e_Precision = unlist(PR_obj@y.values)
PREBP_index = which.min(abs(e_Recall-e_Precision))[1]
e_PREBP     = e_Recall[PREBP_index] #= e_Precision[PREBP_index]

# 3.4.4 F-Measure



