################################################################################
# Analyze Reports - Estimating the Remaining Minorities
################################################################################
## Initialization
cat("\014"); rm(list = ls())
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))
options(digits=3)


################
# Get the data #
################
reports_folder = file.path(getwd(),"reports")
reports = import.reports(reports_folder)
colnames(reports)


##################
# Pro-processing #
##################
## Change policies names
names_original = c("max_tuv-random","greedy-svm","eps_greedy-svm","max_tuv-svm")
names_new      = c("Random","Greedy","eps-Greedy","Informativeness")
for(i in 1:length(names_original))
{
    old_name = names_original[i]
    new_name = names_new[i]
    reports[reports$Policy %in% old_name,"Policy"] = new_name
}# end changing policies names
# Plot the aggregated data  
## Choose policy
ChosenPolicy =  c("Random","Greedy","eps-Greedy","Informativeness")[2]
# ChosenRepetition = 1:6
## Subset the data
report = subset(reports, Policy==ChosenPolicy, #& Repetition==ChosenRepetition,
                select=c("Iteration",
                         "Nu","Nl",
                         "Nu_minority","Nl_minority","Nu_minority.est",
                         "alpha","beta"))


#################################
# Beta Distribution Expectation #
#################################
## Apply transformations
report = transform(report, BetaDistExp=round(Nu*alpha/(alpha+beta)))
## Aggregate the data
report_agg = aggregate(cbind(BetaDistExp,Nu_minority) ~ Nu,
                       data=report,
                       function(x) mean(x,na.rm=T))
x  = report_agg$Nu
y1 = report_agg$Nu_minority
y2 = report_agg$BetaDistExp


############################################
# Playing with the estimated probabilities #
############################################
## Summing the estimated probabilities
report_agg = aggregate(Nu_minority.est ~ Nu,
                       data=report,
                       function(x) mean(x,na.rm=T))
y3 = report_agg$Nu_minority.est[-1]


#################
# Visualisation #
#################
par(mar=c(4,4,1,1), mfrow=c(1,1))
## Plot the curves
plot(0,0,type="n",
     main=paste0("Minorities estimation with ",ChosenPolicy," policy"),
     xlim=rev(range(x)), xlab="Number of instances within the unlabeled-set",
     ylim=range(c(y1,y2),na.rm=T), ylab="Number of minorities remaining")
lines(x, y1, type="o", col=1) # Real value
lines(x, y2, type="o", col=2) # Beta Distribution Expectation
lines(x, y3, type="o", col=3) # Probabilities Estimation Sum

legend("topright",
       c("Real value","Beta Distribution Expectation","Probabilities Estimation Sum"),
       lty=1, col=1:3, bty="n")