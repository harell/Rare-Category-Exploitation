################################################################################
# Analyze Reports - Produce ggplot2 Graphs
################################################################################
## Initialization
cat("\014"); rm(list = ls())
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))


################
# Get the data #
################
reports_folder = file.path(getwd(),"reports")
reports = import.reports(reports_folder)
reports = dplyr::arrange(reports, Policy, Repetition)


##################
# Pre-processing #
##################
## Change policies names
for(p in 1:nrow(policies_metadata))
{
    original_name = policies_metadata[p,"names_original"]
    new_name      = policies_metadata[p,"names_new"]
    reports[reports$Policy %in% original_name,"Policy"] = new_name
}# end changing policies names

## Summary Statistics of Data Subsets
reports_agg = aggregate(Nl_minority ~ Policy + Inducer + Iteration + Nl + DATABASE_NAME,
                        reports, function(x) mean(x,trim=0.0,na.rm=TRUE))


#################
# Visualization #
#################
## Render plots
fig2 = ggplot(reports_agg, aes(x=Nl, y=Nl_minority, group=Policy, color=Policy, shape=Policy)) + 
    # Add lines to the plot
    geom_line(show.legend=T) +
    geom_hline(yintercept=0) +  geom_vline(xintercept=0) +
    # Add scatter points to the plot
    geom_point() +
    # Axes
    ## Set axis limits and ticks
    scale_x_continuous(breaks=seq(0,max(reports_agg$Nl),200)) +
    # Titles
    ggtitle(paste(unique(reports_agg$DATABASE_NAME),"dataset")) +
    xlab("# of labeled instances") +
    ylab("# minorities within the labeled set") +
    # Theme attributes
    theme_bw() + 
    theme(legend.background=element_rect(fill="transparent"),
          # Put bottom-right corner of legend box in bottom-right corner of graph
          legend.justification=c(1,0), legend.position=c(1,0),
          # X axis
          axis.text.x=element_text(angle=-90 ,vjust=0)) +


## Temporary-Minority Space
### Nl_minority: Calculate curve's AUC
xmin = min(reports_agg[,"Nl"])-min(reports_agg[,"Nl_minority"])
xmax = 12*100
ymin = min(reports_agg[,"Nl_minority"])
ymax = max(reports_agg[,"Nl_minority"])
# Add boundaries
fig2 = fig2 + 
    ## Left
    geom_abline(intercept=-xmin, slope=1, linetype="dashed") + 
    ## Right
    geom_vline(xintercept=xmax, linetype="dashed") +
    ## Upper
    geom_hline(yintercept=ymax, linetype="dashed") +
    ## Bottom
    geom_hline(yintercept=ymin, linetype="dashed")




plot(fig2)











