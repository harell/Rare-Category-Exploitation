################################################################################
# Analyze Reports - Produce Graphs
################################################################################
## Initialization
cat("\014"); rm(list = ls())
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))


################
# Get the data #
################
reports_folder = file.path(getwd(),"reports")
reports = import.reports(reports_folder)
colnames(reports)


##################
# Pro-processing #
##################
# Imb.R.Empirical
reports = transform(reports, Imb.R.Empirical=round(Nl_majority/Nl_minority,1))
# SV.R
reports = transform(reports, SV.R=round(SV_majority/SV_minority,1))
# Summary Statistics of Data Subsets
reports_agg = aggregate(
    cbind(Nu_minority, Nl_minority,
          AUC, PRBEP, LIFT,
          SV_minority, SV_majority, SV.R,
          Imb.R.Empirical) ~ QueryMethod + Iteration + Nl,
    reports, mean)
colnames(reports_agg)


#################
# Visualization #
#################
criterion = c("Nu_minority",          # 1
              "Nl_minority",          # 2
              "AUC",                  # 3 
              "PRBEP",                # 4
              "LIFT",                 # 5
              "Imb.R.Empirical",      # 6
              "SV_minority",          # 7     
              "SV_majority",          # 8
              "SV.R")[9]              # 9

xlim=c(0,range(subset(reports_agg, select=Nl))[2])
plot(0, 0, type="n", 
     xlim=xlim, xlab="N",
     ylim=range(reports_agg[,criterion]), ylab=criterion)
lines(reports_agg[reports_agg$QueryMethod %in% "random","Nl"], 
      reports_agg[reports_agg$QueryMethod %in% "random",criterion], 
      col=1, type="o")
lines(reports_agg[reports_agg$QueryMethod %in% "svm","Nl"],    
      reports_agg[reports_agg$QueryMethod %in% "svm",criterion],    
      col=2, type="o")
abline(v=900)
legend("bottom",c("Random","SVM"), lty=1, col=1:2, bty="n")
