################################################################################
# Lustiger2016 - t-tests for Policies Robustness
################################################################################
## Initialization
cat("\014"); rm(list = ls())
source("scripts/load_libraries.R")
invisible(sapply(list.files(pattern="[.]R$", path="./functions/", full.names=TRUE), source))
options(digits=3)
# 1. Choose x limits
Xlimits = c(0,48) # 48 = 4 years # NA
# 2. Choose inducers
Chosen_inducers = c("SVM","GLM","Ensemble")[c(1)]
Chosen_policies = NA  # policies_metadata$names_new
# Chosen_policies = c("(SVM) Random Instances","(SVM) Informativeness")
# Chosen_policies = c("(SVM) Random Instances","(SVM) Informativeness","(SVM) Greedy")
# Chosen_policies = c("(SVM) Random Instances","(SVM) Informativeness","(SVM) Greedy","(SVM) eps-Greedy (Quantile)","(SVM) eps-Greedy (Random)")


################
# Get the data #
################
reports_folder = file.path(getwd(),"reports")
reports = import.reports(reports_folder)
reports = dplyr::arrange(reports, Policy, Repetition)


##################
# Pre-processing #
##################
## Change policies names
for(p in 1:nrow(policies_metadata))
{
    original_name = policies_metadata[p,"names_original"]
    new_name      = policies_metadata[p,"names_new"]
    reports[reports$Policy %in% original_name,"Policy"] = new_name
}# end changing policies names
## Keep only the desierd policies
if(!is.na(Chosen_policies[1]))
    reports = subset(reports,Policy %in% Chosen_policies)


#######################
# AUCTM paired t-test #
#######################
x_max = 12 * 100
X = subset(reports,Nl %in% x_max, select=c("Policy","Repetition","AUCTM"))
g = sort(unique(X$Policy))
M = matrix(NA,length(g),length(g))
K = data.frame(p.value=rep(NA,length(g)^2), mu1=rep(NA,length(g)^2), mu2=rep(NA,length(g)^2))
rownames(M) = colnames(M) = substr(g, star=7, stop=1e3)
# paired t-test
k=1

for(i in 1:length(g))
{
    for(j in 1:length(g))
    {
        x1 = unlist(subset(X, Policy %in% g[i], select="AUCTM"))
        x2 = unlist(subset(X, Policy %in% g[j], select="AUCTM"))
        M[i,j] = t.test(x1, x2, paired=TRUE, alternative="less")$p.value # where y1 & y2 are numeric
        K[k,1] = M[i,j]
        K[k,2] = mean(x1)
        K[k,3] = mean(x2)
        rownames(K)[k] = paste0(g[i]," < ",g[j])
        k = k+1
    } # end for j
    
} # end paired t-test 

round(M,4)
round(K,4)

write.csv(M, file.path(getwd(),"paper",paste(unique(reports$DATABASE_NAME),unique(reports$Inducer),"paired t-test.csv")))


